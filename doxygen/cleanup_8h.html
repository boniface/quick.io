<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>QuickIO: lib/quick-event/src/cleanup.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">QuickIO
   &#160;<span id="projectnumber">0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_b261912c97c901759a7740fd897ed997.html">quick-event</a></li><li class="navelem"><a class="el" href="dir_95ddc183e27dff4f6e8bfed7d062aafa.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cleanup.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>For data that lives the life of the server, this provides a quick way to create and forget about freeing them.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="qev_8h_source.html">qev.h</a>&quot;</code><br/>
</div>
<p><a href="cleanup_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af824539c18c274260ae6243b772866d9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af824539c18c274260ae6243b772866d9"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cleanup_8h.html#af824539c18c274260ae6243b772866d9">qev_cleanup</a> (void *ptr, const <a class="el" href="qev_8h.html#ab0e29aa904c50e484402e27c833f28b6">qev_free_fn</a> free_fn)</td></tr>
<tr class="memdesc:af824539c18c274260ae6243b772866d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calls <a class="el" href="cleanup_8h.html#af824539c18c274260ae6243b772866d9" title="Calls qev_cleanup() with last=FALSE. ">qev_cleanup()</a> with last=FALSE. <br/></td></tr>
<tr class="separator:af824539c18c274260ae6243b772866d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a092da2fafee92c738a2346b964c5e69b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cleanup_8h.html#a092da2fafee92c738a2346b964c5e69b">qev_cleanup_full</a> (void *ptr, const <a class="el" href="qev_8h.html#ab0e29aa904c50e484402e27c833f28b6">qev_free_fn</a> free_fn, const gboolean last)</td></tr>
<tr class="memdesc:a092da2fafee92c738a2346b964c5e69b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a pointer to a thread-local that needs to be cleaned up on exit.  <a href="#a092da2fafee92c738a2346b964c5e69b">More...</a><br/></td></tr>
<tr class="separator:a092da2fafee92c738a2346b964c5e69b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ea45d562610b44ce2b7459ce30b5e3e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6ea45d562610b44ce2b7459ce30b5e3e"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cleanup_8h.html#a6ea45d562610b44ce2b7459ce30b5e3e">qev_cleanup_and_null</a> (void **ptrptr, const <a class="el" href="qev_8h.html#ab0e29aa904c50e484402e27c833f28b6">qev_free_fn</a> free_fn)</td></tr>
<tr class="memdesc:a6ea45d562610b44ce2b7459ce30b5e3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calls <a class="el" href="cleanup_8h.html#ad9331069ae4bb53ce80400a9580790f6" title="Adds a pointer to be cleaned up and set to NULL on exit. ">qev_cleanup_and_null_full()</a> with last=FALSE. <br/></td></tr>
<tr class="separator:a6ea45d562610b44ce2b7459ce30b5e3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9331069ae4bb53ce80400a9580790f6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cleanup_8h.html#ad9331069ae4bb53ce80400a9580790f6">qev_cleanup_and_null_full</a> (void **ptrptr, const <a class="el" href="qev_8h.html#ab0e29aa904c50e484402e27c833f28b6">qev_free_fn</a> free_fn, const gboolean last)</td></tr>
<tr class="memdesc:ad9331069ae4bb53ce80400a9580790f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a pointer to be cleaned up and set to NULL on exit.  <a href="#ad9331069ae4bb53ce80400a9580790f6">More...</a><br/></td></tr>
<tr class="separator:ad9331069ae4bb53ce80400a9580790f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7212c1f7538190552b3eedf8a9e9a258"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7212c1f7538190552b3eedf8a9e9a258"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cleanup_8h.html#a7212c1f7538190552b3eedf8a9e9a258">qev_cleanup_fn</a> (const <a class="el" href="qev_8h.html#a01d7c0d364033b754c3636a8d5604546">qev_cb</a> fn)</td></tr>
<tr class="memdesc:a7212c1f7538190552b3eedf8a9e9a258"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calls <a class="el" href="cleanup_8h.html#ab299028097935b437bf387fa30e47b4b" title="Adds a simple function to be called on exit. ">qev_cleanup_fn_full()</a> with last=FALSE. <br/></td></tr>
<tr class="separator:a7212c1f7538190552b3eedf8a9e9a258"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab299028097935b437bf387fa30e47b4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cleanup_8h.html#ab299028097935b437bf387fa30e47b4b">qev_cleanup_fn_full</a> (const <a class="el" href="qev_8h.html#a01d7c0d364033b754c3636a8d5604546">qev_cb</a> cb, const gboolean last)</td></tr>
<tr class="memdesc:ab299028097935b437bf387fa30e47b4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a simple function to be called on exit.  <a href="#ab299028097935b437bf387fa30e47b4b">More...</a><br/></td></tr>
<tr class="separator:ab299028097935b437bf387fa30e47b4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>For data that lives the life of the server, this provides a quick way to create and forget about freeing them. </p>
<p>On server exit, all registered pointers will have their free functions called and their original pointers will be nulled out.</p>
<p>The cleanup functions are called in the reverse of the order they were added; that is, most-recently added is called first. Since programs typically boot by starting dependencies first, it only makes sense to tear down what nothing depends on while leaving the dependencies until last to make sure everything exits smoothly.</p>
<dl class="section author"><dt>Author</dt><dd>Andrew Stone <a href="#" onclick="location.href='mai'+'lto:'+'and'+'re'+'w@c'+'lo'+'var'+'.c'+'om'; return false;">andre<span style="display: none;">.nosp@m.</span>w@cl<span style="display: none;">.nosp@m.</span>ovar.<span style="display: none;">.nosp@m.</span>com</a> </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2012-2014 Clear Channel Inc. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ad9331069ae4bb53ce80400a9580790f6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void qev_cleanup_and_null_full </td>
          <td>(</td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>ptrptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="qev_8h.html#ab0e29aa904c50e484402e27c833f28b6">qev_free_fn</a>&#160;</td>
          <td class="paramname"><em>free_fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gboolean&#160;</td>
          <td class="paramname"><em>last</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a pointer to be cleaned up and set to NULL on exit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptrptr</td><td>A pointer to the pointer to be cleared out and null'd on exit. </td></tr>
    <tr><td class="paramname">free_fn</td><td>The function to free the pointer on exit. </td></tr>
    <tr><td class="paramname">last</td><td>If the item should be freed after everything else. This is useful for things that must last the life of the server and are used during shutdown. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab299028097935b437bf387fa30e47b4b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void qev_cleanup_fn_full </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="qev_8h.html#a01d7c0d364033b754c3636a8d5604546">qev_cb</a>&#160;</td>
          <td class="paramname"><em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gboolean&#160;</td>
          <td class="paramname"><em>last</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a simple function to be called on exit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>The function to call on exit </td></tr>
    <tr><td class="paramname">last</td><td>If the function should be called after everything else </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a092da2fafee92c738a2346b964c5e69b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void qev_cleanup_full </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="qev_8h.html#ab0e29aa904c50e484402e27c833f28b6">qev_free_fn</a>&#160;</td>
          <td class="paramname"><em>free_fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gboolean&#160;</td>
          <td class="paramname"><em>last</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a pointer to a thread-local that needs to be cleaned up on exit. </p>
<dl class="section note"><dt>Note</dt><dd>Since QEV threads rely on thread local values existing, these values are cleaned up once all QEV threads have exited. In practice, that typically means they're cleaned up last.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td>The pointer to pass to the free function on exit. </td></tr>
    <tr><td class="paramname">free_fn</td><td>The function to free the pointer on exit. </td></tr>
    <tr><td class="paramname">last</td><td>If the item should be freed after everything else. This is useful for things that must last the life of the server and are used during shutdown. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu May 22 2014 11:23:00 for QuickIO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
